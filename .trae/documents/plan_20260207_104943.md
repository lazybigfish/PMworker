# 系统重构与架构优化方案 (System Refactoring & Architecture Optimization Plan)

本方案旨在将现有的 `PMworker` 项目从传统的 React JS 架构升级为现代化、高性能、易维护的 TypeScript 企业级应用，同时实现视觉风格的统一和架构的深度优化。

## 1. 视觉设计系统重构 (Visual Design System)

**目标**：对标参考图示，统一全站视觉语言。

* **设计规范落地**：

  * 基于 `Ant Design` 的 `ConfigProvider` 定制全局主题（Token System）。

  * **色彩**：确立主色调（参考图示蓝色）、辅助色、中性色（文字、边框、背景）。

  * **排版**：规范字体大小、行高、字重。

  * **组件样式**：统一圆角（Radius）、阴影（Shadow）、间距（Spacing）。

* **布局重构**：

  * 移除 `App.jsx` 中的内联样式，封装为响应式 `MainLayout` 组件。

  * 实现 **侧边栏 (Sidebar)**：支持折叠/展开，层级清晰。

  * 实现 **顶部导航 (Header)**：包含面包屑、用户中心、搜索入口。

  * 实现 **内容区 (Content)**：统一的卡片式容器风格。

## 2. 系统架构升级 (Architecture Refactoring)

**目标**：构建高内聚、低耦合、可扩展的架构。

* **技术栈升级**：

  * **TypeScript 迁移**：引入 `typescript`，配置 `tsconfig.json`，逐步将 `.jsx` 转换为 `.tsx`，补充类型定义。

  * **构建工具优化**：配置 Vite 路径别名 (`@/`)，优化打包策略。

* **目录结构重组**：

  ```text
  src/
  ├── api/          # 统一 API 接口层 (Axios 拦截器, 请求封装)
  ├── assets/       # 静态资源
  ├── components/   # 公共组件 (Atomic Design)
  ├── hooks/        # 自定义 Hooks (逻辑复用)
  ├── layouts/      # 布局组件 (MainLayout, AuthLayout)
  ├── pages/        # 页面视图 (按路由划分)
  ├── router/       # 路由配置 (Lazy Loading)
  ├── store/        # 全局状态管理 (Zustand/Context)
  ├── types/        # TypeScript 类型定义
  ├── utils/        # 工具函数
  └── styles/       # 全局样式
  ```

* **核心模块设计**：

  * **状态管理**：使用 `Zustand` 或 `Context API` 管理全局状态（用户信息、权限、主题配置）。

  * **API 层**：封装统一的 HTTP 请求类，处理 Token 注入、全局错误拦截、响应数据标准化。

  * **路由系统**：实现路由配置化，支持动态路由、权限守卫 (AuthGuard)、代码分割 (Lazy)。

## 3. 功能迁移与优化 (Content Retention & Optimization)

**目标**：在保留原有业务逻辑的基础上提升代码质量。

* **组件拆分**：

  * 将庞大的 `TaskManager.jsx` 等页面拆分为展示组件 (UI) 和容器组件 (Logic)。

  * 提取通用逻辑至自定义 Hooks (如 `useTaskOperations`, `usePermissions`)。

* **逻辑复用**：

  * 统一权限判断逻辑 (`HasPermission` 组件)。

  * 统一数据格式化工具 (日期、金额、状态映射)。

## 4. 质量保障与交付 (QA & Deliverables)

**目标**：确保系统稳定性与可维护性。

* **测试体系**：

  * 引入 `Vitest` + `React Testing Library`。

  * 编写核心工具函数和关键组件的单元测试（覆盖率 > 80%）。

* **错误监控**：

  * 实现 `ErrorBoundary` 全局错误边界，防止页面白屏。

* **文档输出**：

  * 生成系统架构图、目录说明、API 调用规范文档。

## 执行计划 (Execution Roadmap)

1. **环境初始化**：安装 TS 依赖，配置 Vite & TSConfig，建立新目录结构。
2. **基础设施搭建**：封装 Axios，配置 Router，搭建 Layout 和主题。
3. **核心模块迁移**：

   * 迁移 `App.jsx` -> `MainLayout` + `Router`.

   * 迁移 `Login` 及认证逻辑。
4. **业务模块重构** (按优先级)：

   * Dashboard & 导航.

   * 任务管理 (TaskManager).

   * 其他业务模块.
5. **测试与收尾**：补充类型定义，编写测试用例，全局样式微调。

